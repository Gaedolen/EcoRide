{% extends 'base.html.twig' %}

{% block title %}Mon profil{% endblock %}

{% block head %}
    <link rel="stylesheet" href="{{ asset('/css/employe/covoiturages_problematiques.css') }}">
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet">
{% endblock %}

{% block body %}
    <h1>Covoiturages problématiques</h1>

    <div class="container-signalement">
        <h2>Liste des signalements</h2>
        <a href="{{ path('employe_historique_signalements') }}" class="btn">Historique des signalements</a>
    </div>


    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th>#</th>
                    <th>Utilisateur signalé</th>
                    <th>Signalé par</th>
                    <th>Message</th>
                    <th>Date</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
            {% for report in reports %}
                <tr>
                    <td>{{ report.covoiturage.id }}</td>
                    <td>
                        <div class='contact'>
                            {{ report.reportedUser.pseudo }}
                            <button type="button" class="btn-contact"data-id="{{ report.reportedUser.id }}"data-pseudo="{{ report.reportedUser.pseudo }}">Contacter</button>
                        </div>
                    </td>
                    <td>
                        <div class='contact'>
                            {{ report.reportedBy.pseudo }}
                            <button type="button" class="btn-contact"data-id="{{ report.reportedBy.id }}"data-pseudo="{{ report.reportedBy.pseudo }}">Contacter</button>
                        </div>
                    </td>
                    <td>{{ report.message }}</td>
                    <td>{{ report.createdAt|date('d/m/Y') }}</td>
                    <td>
                        <form action="{{ path('employe_traiter_signalement', {id: report.id}) }}" method="post">
                            <input type="hidden" name="_token" value="{{ csrf_token('traiter_report_' ~ report.id) }}">
                            <button type="submit" class="btn-traiter">Traiter</button>
                        </form>

                        <form action="{{ path('employe_ignorer_signalement', {id: report.id}) }}" method="post">
                            <input type="hidden" name="_token" value="{{ csrf_token('ignorer_report_' ~ report.id) }}">
                            <button type="submit" class="btn-ignorer">Ignorer</button>
                        </form>
                    </td>
                </tr>
            {% else %}
                <tr>
                    <td colspan="6" style="text-align:center; color: #777;">
                        Aucun signalement pour le moment.
                    </td>
                </tr>
            {% endfor %}
            </tbody>

        </table>
    </div>

    <h2 class="titre">Signaler un utilisateur</h2>

    <div class="signalement-container">
        {{ form_start(form, {'attr': {'id': 'form-signalement'}, 'csrf_token_id': 'signalement_employe'}) }}
            {{ form_row(form.reportedUser) }}
            {{ form_row(form.message) }}
            <button type="submit">Envoyer le signalement</button>
        {{ form_end(form) }}
    </div>


    <!-- Fenêtre pop-up pour envoyer un mail -->
    <div id="contactModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2 id="modalTitle">Envoyer un mail</h2>
            <form id="contactForm" method="POST">
                <input type="hidden" name="_token" value="{{ csrf_token('contacter_utilisateur') }}">
                <label for="subject">Objet</label>
                <input type="text" id="subject" name="subject" required>
                <label for="message">Message</label>
                <textarea id="message" name="message" required></textarea>
                <button type="submit">Envoyer</button>
            </form>
        </div>
    </div>

    {% block javascripts %}
        <script src="{{ asset('js/contact-modal.js') }}"></script>
        {{ parent() }}
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
        <script>
            document.addEventListener('DOMContentLoaded', function () {
            const $el = $('.user-select');
            if ($el.length) {
                $el.select2({
                width: '100%',
                placeholder: $el.data('placeholder') || 'Cherchez un pseudo…',
                allowClear: true,
                language: 'fr'
                });
            }
            });
        </script>
    {% endblock %}

{% endblock %}