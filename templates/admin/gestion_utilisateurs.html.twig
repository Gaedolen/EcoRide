{% extends 'base.html.twig' %}

{% block title %}Gestion des utilisateurs{% endblock %}

{% block head %}
    <link rel="stylesheet" href="{{ asset('/css/admin/gestion_utilisateurs.css') }}">
{% endblock %}

{% block body %}
    <div class="users-container">
        <h1>Gestion des utilisateurs</h1>

        <table>
            <thead>
                <tr>
                    <th>Pseudo</th>
                    <th>Email</th>
                    <th>Signalements</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for user in users %}
                <tr>
                    <td>{{ user.pseudo|e }} {% if reportsByUser[user.id]|default([]) is not empty %}⚠️{% endif %}</td>
                    <td>{{ user.email|e }}</td>
                    <td>
                        {% set userReports = reportsByUser[user.id]|default([]) %}
                        {% if userReports is not empty %}
                            <ul>
                            {% for report in userReports %}
                                <li>{{ report.message|e }} (signalé par {{ report.reportedBy.pseudo|e }})</li>
                            {% endfor %}
                            </ul>
                        {% else %}-{% endif %}
                    </td>
                    <td>
                        {% if not user.isSuspended %}
                            <button class="btn-suspend"
                                    data-user-id="{{ user.id }}"
                                    data-user-pseudo="{{ user.pseudo|e('html_attr') }}"
                                    data-csrf-suspend="{{ csrf_token('suspend_user_' ~ user.id) }}"
                                    data-csrf-unsuspend="{{ csrf_token('unsuspend_user_' ~ user.id) }}">
                                Suspendre
                            </button>
                        {% else %}
                            <button class="btn-reactivate"
                                    data-user-id="{{ user.id }}"
                                    data-csrf-unsuspend="{{ csrf_token('unsuspend_user_' ~ user.id) }}">
                                Réactiver
                            </button>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Modal suspendre -->
    <div id="modal-suspendre" class="modal" style="display:none; justify-content:center; align-items:center;">
        <div class="modal-content">
            <span class="modal-close">&times;</span>
            <h2>Suspendre <span id="modal-user-pseudo"></span></h2>
            <form id="form-suspendre">
                <input type="hidden" id="user-id">
                <input type="hidden" id="csrf-token">
                
                <label for="reason">Raison :</label>
                <select id="reason" name="reason">
                    <option value="retard">Retard récurrent</option>
                    <option value="charte">Non respect des règles du site</option>
                    <option value="comportement">Comportement inapproprié</option>
                    <option value="autres">Autres</option>
                </select>
                
                <input type="text" id="other-reason" name="otherReason" placeholder="Précisez la raison" style="display:none; margin-top:10px;">
                
                <button type="submit" style="margin-top:15px;">Suspendre</button>
            </form>
        </div>
    </div>

    <script src="{{ asset('js/gestion_utilisateurs.js') }}"></script>
{% endblock %}
